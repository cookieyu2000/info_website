{"ast":null,"code":"import _objectSpread from\"/Users/cookie/Desktop/info/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{createContext,useContext,useEffect,useMemo,useState}from'react';import localContent from'../content';import{supabase}from'../lib/supabaseClient';import{jsx as _jsx}from\"react/jsx-runtime\";const LanguageContext=/*#__PURE__*/createContext(null);const mergeDeep=(base,override)=>{if(override===null||override===undefined){return base;}if(Array.isArray(base)||Array.isArray(override)){return override;}if(typeof base!=='object'||typeof override!=='object'){return override;}const result=_objectSpread({},base);Object.keys(override).forEach(key=>{result[key]=mergeDeep(base===null||base===void 0?void 0:base[key],override[key]);});return result;};export function LanguageProvider(_ref){let{children,initialLanguage='zh',initialContent,enableRemote=true}=_ref;const[language,setLanguage]=useState(initialLanguage);const[contentState,setContentState]=useState(initialContent||localContent);useEffect(()=>{document.documentElement.lang=language==='zh'?'zh-Hant':'en';},[language]);useEffect(()=>{if(!enableRemote||!supabase){return undefined;}let isMounted=true;const loadContent=async()=>{const{data,error}=await supabase.from('site_content').select('locale,data');if(error||!data){return;}const merged=_objectSpread({},localContent);data.forEach(row=>{if(row.locale&&row.data){merged[row.locale]=mergeDeep(localContent[row.locale]||{},row.data);}});if(isMounted){setContentState(merged);}};loadContent();return()=>{isMounted=false;};},[enableRemote]);const value=useMemo(()=>({language,setLanguage,content:contentState[language]||contentState.zh}),[language,contentState]);return/*#__PURE__*/_jsx(LanguageContext.Provider,{value:value,children:children});}export function useLanguage(){const context=useContext(LanguageContext);if(!context){throw new Error('useLanguage must be used within LanguageProvider');}return context;}","map":{"version":3,"names":["createContext","useContext","useEffect","useMemo","useState","localContent","supabase","jsx","_jsx","LanguageContext","mergeDeep","base","override","undefined","Array","isArray","result","_objectSpread","Object","keys","forEach","key","LanguageProvider","_ref","children","initialLanguage","initialContent","enableRemote","language","setLanguage","contentState","setContentState","document","documentElement","lang","isMounted","loadContent","data","error","from","select","merged","row","locale","value","content","zh","Provider","useLanguage","context","Error"],"sources":["/Users/cookie/Desktop/info/src/context/LanguageContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport localContent from '../content';\nimport { supabase } from '../lib/supabaseClient';\n\nconst LanguageContext = createContext(null);\n\nconst mergeDeep = (base, override) => {\n  if (override === null || override === undefined) {\n    return base;\n  }\n\n  if (Array.isArray(base) || Array.isArray(override)) {\n    return override;\n  }\n\n  if (typeof base !== 'object' || typeof override !== 'object') {\n    return override;\n  }\n\n  const result = { ...base };\n\n  Object.keys(override).forEach((key) => {\n    result[key] = mergeDeep(base?.[key], override[key]);\n  });\n\n  return result;\n};\n\nexport function LanguageProvider({\n  children,\n  initialLanguage = 'zh',\n  initialContent,\n  enableRemote = true,\n}) {\n  const [language, setLanguage] = useState(initialLanguage);\n  const [contentState, setContentState] = useState(\n    initialContent || localContent\n  );\n\n  useEffect(() => {\n    document.documentElement.lang = language === 'zh' ? 'zh-Hant' : 'en';\n  }, [language]);\n\n  useEffect(() => {\n    if (!enableRemote || !supabase) {\n      return undefined;\n    }\n\n    let isMounted = true;\n\n    const loadContent = async () => {\n      const { data, error } = await supabase\n        .from('site_content')\n        .select('locale,data');\n\n      if (error || !data) {\n        return;\n      }\n\n      const merged = { ...localContent };\n\n      data.forEach((row) => {\n        if (row.locale && row.data) {\n          merged[row.locale] = mergeDeep(\n            localContent[row.locale] || {},\n            row.data\n          );\n        }\n      });\n\n      if (isMounted) {\n        setContentState(merged);\n      }\n    };\n\n    loadContent();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [enableRemote]);\n\n  const value = useMemo(\n    () => ({\n      language,\n      setLanguage,\n      content: contentState[language] || contentState.zh,\n    }),\n    [language, contentState]\n  );\n\n  return (\n    <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>\n  );\n}\n\nexport function useLanguage() {\n  const context = useContext(LanguageContext);\n\n  if (!context) {\n    throw new Error('useLanguage must be used within LanguageProvider');\n  }\n\n  return context;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}